Object.defineProperty(exports, '__esModule', {
  value: true
});

var _atom = require('atom');

var _helpers = require('./helpers');

var VALID_SEVERITY = new Set(['error', 'warning', 'info']);

function validateUI(ui) {
  var messages = [];

  if (ui && typeof ui === 'object') {
    if (typeof ui.name !== 'string') {
      messages.push('UI.name must be a string');
    }
    if (typeof ui.didBeginLinting !== 'function') {
      messages.push('UI.didBeginLinting must be a function');
    }
    if (typeof ui.didFinishLinting !== 'function') {
      messages.push('UI.didFinishLinting must be a function');
    }
    if (typeof ui.render !== 'function') {
      messages.push('UI.render must be a function');
    }
    if (typeof ui.dispose !== 'function') {
      messages.push('UI.dispose must be a function');
    }
  } else {
    messages.push('UI must be an object');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid UI received', 'These issues were encountered while registering the UI named \'' + (ui && ui.name ? ui.name : 'Unknown') + '\'', messages);
    return false;
  }

  return true;
}

function validateLinter(linter) {
  var messages = [];

  if (linter && typeof linter === 'object') {
    if (typeof linter.name !== 'string') {
      messages.push('Linter.name must be a string');
    }
    if (typeof linter.scope !== 'string' || linter.scope !== 'file' && linter.scope !== 'project') {
      messages.push("Linter.scope must be either 'file' or 'project'");
    }
    if (typeof linter.lintsOnChange !== 'boolean') {
      messages.push('Linter.lintsOnChange must be a boolean');
    }
    if (!Array.isArray(linter.grammarScopes)) {
      messages.push('Linter.grammarScopes must be an Array');
    }
    if (typeof linter.lint !== 'function') {
      messages.push('Linter.lint must be a function');
    }
  } else {
    messages.push('Linter must be an object');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid Linter received', 'These issues were encountered while registering a Linter named \'' + (linter && linter.name ? linter.name : 'Unknown') + '\'', messages);
    return false;
  }

  return true;
}

function validateIndie(indie) {
  var messages = [];

  if (indie && typeof indie === 'object') {
    if (typeof indie.name !== 'string') {
      messages.push('Indie.name must be a string');
    }
  } else {
    messages.push('Indie must be an object');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid Indie received', 'These issues were encountered while registering an Indie Linter named \'' + (indie && indie.name ? indie.name : 'Unknown') + '\'', messages);
    return false;
  }

  return true;
}

function validateMessages(linterName, entries) {
  var messages = [];

  if (Array.isArray(entries)) {
    var invalidURL = false;
    var invalidIcon = false;
    var invalidExcerpt = false;
    var invalidLocation = false;
    var invalidSeverity = false;
    var invalidSolution = false;
    var invalidReference = false;
    var invalidDescription = false;
    var invalidLinterName = false;

    for (var i = 0, _length = entries.length; i < _length; ++i) {
      var message = entries[i];
      var reference = message.reference;

      if (!invalidIcon && message.icon && typeof message.icon !== 'string') {
        invalidIcon = true;
        messages.push('Message.icon must be a string');
      }
      if (!invalidLocation && (!message.location || typeof message.location !== 'object' || typeof message.location.file !== 'string' || typeof message.location.position !== 'object' || !message.location.position)) {
        invalidLocation = true;
        messages.push('Message.location must be valid');
      } else if (!invalidLocation) {
        var range = _atom.Range.fromObject(message.location.position);
        if (Number.isNaN(range.start.row) || Number.isNaN(range.start.column) || Number.isNaN(range.end.row) || Number.isNaN(range.end.column)) {
          invalidLocation = true;
          messages.push('Message.location.position should not contain NaN coordinates');
        }
      }
      if (!invalidSolution && message.solutions && !Array.isArray(message.solutions)) {
        invalidSolution = true;
        messages.push('Message.solutions must be valid');
      }
      if (!invalidReference && reference && (typeof reference !== 'object' || typeof reference.file !== 'string' || typeof reference.position !== 'object' || !reference.position)) {
        invalidReference = true;
        messages.push('Message.reference must be valid');
      } else if (!invalidReference && reference) {
        var position = _atom.Point.fromObject(reference.position);
        if (Number.isNaN(position.row) || Number.isNaN(position.column)) {
          invalidReference = true;
          messages.push('Message.reference.position should not contain NaN coordinates');
        }
      }
      if (!invalidExcerpt && typeof message.excerpt !== 'string') {
        invalidExcerpt = true;
        messages.push('Message.excerpt must be a string');
      }
      if (!invalidSeverity && !VALID_SEVERITY.has(message.severity)) {
        invalidSeverity = true;
        messages.push("Message.severity must be 'error', 'warning' or 'info'");
      }
      if (!invalidURL && message.url && typeof message.url !== 'string') {
        invalidURL = true;
        messages.push('Message.url must be a string');
      }
      if (!invalidDescription && message.description && typeof message.description !== 'function' && typeof message.description !== 'string') {
        invalidDescription = true;
        messages.push('Message.description must be a function or string');
      }
      if (!invalidLinterName && message.linterName && typeof message.linterName !== 'string') {
        invalidLinterName = true;
        messages.push('Message.linterName must be a string');
      }
    }
  } else {
    messages.push('Linter Result must be an Array');
  }

  if (messages.length) {
    (0, _helpers.showError)('Invalid Linter Result received', 'These issues were encountered while processing messages from a linter named \'' + linterName + '\'', messages);
    return false;
  }

  return true;
}

exports.ui = validateUI;
exports.linter = validateLinter;
exports.indie = validateIndie;
exports.messages = validateMessages;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL215dWdhLy5hdG9tL3BhY2thZ2VzL2xpbnRlci9saWIvdmFsaWRhdGUvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztvQkFFNkIsTUFBTTs7dUJBQ1QsV0FBVzs7QUFHckMsSUFBTSxjQUFjLEdBQUcsSUFBSSxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUE7O0FBRTVELFNBQVMsVUFBVSxDQUFDLEVBQU0sRUFBVztBQUNuQyxNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUE7O0FBRW5CLE1BQUksRUFBRSxJQUFJLE9BQU8sRUFBRSxLQUFLLFFBQVEsRUFBRTtBQUNoQyxRQUFJLE9BQU8sRUFBRSxDQUFDLElBQUksS0FBSyxRQUFRLEVBQUU7QUFDL0IsY0FBUSxDQUFDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFBO0tBQzFDO0FBQ0QsUUFBSSxPQUFPLEVBQUUsQ0FBQyxlQUFlLEtBQUssVUFBVSxFQUFFO0FBQzVDLGNBQVEsQ0FBQyxJQUFJLENBQUMsdUNBQXVDLENBQUMsQ0FBQTtLQUN2RDtBQUNELFFBQUksT0FBTyxFQUFFLENBQUMsZ0JBQWdCLEtBQUssVUFBVSxFQUFFO0FBQzdDLGNBQVEsQ0FBQyxJQUFJLENBQUMsd0NBQXdDLENBQUMsQ0FBQTtLQUN4RDtBQUNELFFBQUksT0FBTyxFQUFFLENBQUMsTUFBTSxLQUFLLFVBQVUsRUFBRTtBQUNuQyxjQUFRLENBQUMsSUFBSSxDQUFDLDhCQUE4QixDQUFDLENBQUE7S0FDOUM7QUFDRCxRQUFJLE9BQU8sRUFBRSxDQUFDLE9BQU8sS0FBSyxVQUFVLEVBQUU7QUFDcEMsY0FBUSxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFBO0tBQy9DO0dBQ0YsTUFBTTtBQUNMLFlBQVEsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLENBQUMsQ0FBQTtHQUN0Qzs7QUFFRCxNQUFJLFFBQVEsQ0FBQyxNQUFNLEVBQUU7QUFDbkIsNEJBQ0Us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SSxDQUFDLGdDQUFnQyxDQUFDLENBQUE7R0FDaEQ7O0FBRUQsTUFBSSxRQUFRLENBQUMsTUFBTSxFQUFFO0FBQ25CLDRCQUNFLGdDQUFnQyxxRkFDZ0QsVUFBVSxTQUMxRixRQUFRLENBQ1QsQ0FBQTtBQUNELFdBQU8sS0FBSyxDQUFBO0dBQ2I7O0FBRUQsU0FBTyxJQUFJLENBQUE7Q0FDWjs7UUFFc0IsRUFBRSxHQUFoQixVQUFVO1FBQTBCLE1BQU0sR0FBeEIsY0FBYztRQUE2QixLQUFLLEdBQXRCLGFBQWE7UUFBK0IsUUFBUSxHQUE1QixnQkFBZ0IiLCJmaWxlIjoiL2hvbWUvbXl1Z2EvLmF0b20vcGFja2FnZXMvbGludGVyL2xpYi92YWxpZGF0ZS9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIEBmbG93ICovXG5cbmltcG9ydCB7IFJhbmdlLCBQb2ludCB9IGZyb20gJ2F0b20nXG5pbXBvcnQgeyBzaG93RXJyb3IgfSBmcm9tICcuL2hlbHBlcnMnXG5pbXBvcnQgdHlwZSB7IFVJLCBMaW50ZXIsIE1lc3NhZ2UsIEluZGllIH0gZnJvbSAnLi4vdHlwZXMnXG5cbmNvbnN0IFZBTElEX1NFVkVSSVRZID0gbmV3IFNldChbJ2Vycm9yJywgJ3dhcm5pbmcnLCAnaW5mbyddKVxuXG5mdW5jdGlvbiB2YWxpZGF0ZVVJKHVpOiBVSSk6IGJvb2xlYW4ge1xuICBjb25zdCBtZXNzYWdlcyA9IFtdXG5cbiAgaWYgKHVpICYmIHR5cGVvZiB1aSA9PT0gJ29iamVjdCcpIHtcbiAgICBpZiAodHlwZW9mIHVpLm5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKCdVSS5uYW1lIG11c3QgYmUgYSBzdHJpbmcnKVxuICAgIH1cbiAgICBpZiAodHlwZW9mIHVpLmRpZEJlZ2luTGludGluZyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnVUkuZGlkQmVnaW5MaW50aW5nIG11c3QgYmUgYSBmdW5jdGlvbicpXG4gICAgfVxuICAgIGlmICh0eXBlb2YgdWkuZGlkRmluaXNoTGludGluZyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnVUkuZGlkRmluaXNoTGludGluZyBtdXN0IGJlIGEgZnVuY3Rpb24nKVxuICAgIH1cbiAgICBpZiAodHlwZW9mIHVpLnJlbmRlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnVUkucmVuZGVyIG11c3QgYmUgYSBmdW5jdGlvbicpXG4gICAgfVxuICAgIGlmICh0eXBlb2YgdWkuZGlzcG9zZSAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnVUkuZGlzcG9zZSBtdXN0IGJlIGEgZnVuY3Rpb24nKVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBtZXNzYWdlcy5wdXNoKCdVSSBtdXN0IGJlIGFuIG9iamVjdCcpXG4gIH1cblxuICBpZiAobWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgc2hvd0Vycm9yKFxuICAgICAgJ0ludmFsaWQgVUkgcmVjZWl2ZWQnLFxuICAgICAgYFRoZXNlIGlzc3VlcyB3ZXJlIGVuY291bnRlcmVkIHdoaWxlIHJlZ2lzdGVyaW5nIHRoZSBVSSBuYW1lZCAnJHt1aSAmJiB1aS5uYW1lID8gdWkubmFtZSA6ICdVbmtub3duJ30nYCxcbiAgICAgIG1lc3NhZ2VzLFxuICAgIClcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHJldHVybiB0cnVlXG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlTGludGVyKGxpbnRlcjogTGludGVyKTogYm9vbGVhbiB7XG4gIGNvbnN0IG1lc3NhZ2VzID0gW11cblxuICBpZiAobGludGVyICYmIHR5cGVvZiBsaW50ZXIgPT09ICdvYmplY3QnKSB7XG4gICAgaWYgKHR5cGVvZiBsaW50ZXIubmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgIG1lc3NhZ2VzLnB1c2goJ0xpbnRlci5uYW1lIG11c3QgYmUgYSBzdHJpbmcnKVxuICAgIH1cbiAgICBpZiAodHlwZW9mIGxpbnRlci5zY29wZSAhPT0gJ3N0cmluZycgfHwgKGxpbnRlci5zY29wZSAhPT0gJ2ZpbGUnICYmIGxpbnRlci5zY29wZSAhPT0gJ3Byb2plY3QnKSkge1xuICAgICAgbWVzc2FnZXMucHVzaChcIkxpbnRlci5zY29wZSBtdXN0IGJlIGVpdGhlciAnZmlsZScgb3IgJ3Byb2plY3QnXCIpXG4gICAgfVxuICAgIGlmICh0eXBlb2YgbGludGVyLmxpbnRzT25DaGFuZ2UgIT09ICdib29sZWFuJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnTGludGVyLmxpbnRzT25DaGFuZ2UgbXVzdCBiZSBhIGJvb2xlYW4nKVxuICAgIH1cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkobGludGVyLmdyYW1tYXJTY29wZXMpKSB7XG4gICAgICBtZXNzYWdlcy5wdXNoKCdMaW50ZXIuZ3JhbW1hclNjb3BlcyBtdXN0IGJlIGFuIEFycmF5JylcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBsaW50ZXIubGludCAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnTGludGVyLmxpbnQgbXVzdCBiZSBhIGZ1bmN0aW9uJylcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbWVzc2FnZXMucHVzaCgnTGludGVyIG11c3QgYmUgYW4gb2JqZWN0JylcbiAgfVxuXG4gIGlmIChtZXNzYWdlcy5sZW5ndGgpIHtcbiAgICBzaG93RXJyb3IoXG4gICAgICAnSW52YWxpZCBMaW50ZXIgcmVjZWl2ZWQnLFxuICAgICAgYFRoZXNlIGlzc3VlcyB3ZXJlIGVuY291bnRlcmVkIHdoaWxlIHJlZ2lzdGVyaW5nIGEgTGludGVyIG5hbWVkICcke2xpbnRlciAmJiBsaW50ZXIubmFtZSA/IGxpbnRlci5uYW1lIDogJ1Vua25vd24nfSdgLFxuICAgICAgbWVzc2FnZXMsXG4gICAgKVxuICAgIHJldHVybiBmYWxzZVxuICB9XG5cbiAgcmV0dXJuIHRydWVcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVJbmRpZShpbmRpZTogSW5kaWUpOiBib29sZWFuIHtcbiAgY29uc3QgbWVzc2FnZXMgPSBbXVxuXG4gIGlmIChpbmRpZSAmJiB0eXBlb2YgaW5kaWUgPT09ICdvYmplY3QnKSB7XG4gICAgaWYgKHR5cGVvZiBpbmRpZS5uYW1lICE9PSAnc3RyaW5nJykge1xuICAgICAgbWVzc2FnZXMucHVzaCgnSW5kaWUubmFtZSBtdXN0IGJlIGEgc3RyaW5nJylcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbWVzc2FnZXMucHVzaCgnSW5kaWUgbXVzdCBiZSBhbiBvYmplY3QnKVxuICB9XG5cbiAgaWYgKG1lc3NhZ2VzLmxlbmd0aCkge1xuICAgIHNob3dFcnJvcihcbiAgICAgICdJbnZhbGlkIEluZGllIHJlY2VpdmVkJyxcbiAgICAgIGBUaGVzZSBpc3N1ZXMgd2VyZSBlbmNvdW50ZXJlZCB3aGlsZSByZWdpc3RlcmluZyBhbiBJbmRpZSBMaW50ZXIgbmFtZWQgJyR7XG4gICAgICAgIGluZGllICYmIGluZGllLm5hbWUgPyBpbmRpZS5uYW1lIDogJ1Vua25vd24nXG4gICAgICB9J2AsXG4gICAgICBtZXNzYWdlcyxcbiAgICApXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICByZXR1cm4gdHJ1ZVxufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZU1lc3NhZ2VzKGxpbnRlck5hbWU6IHN0cmluZywgZW50cmllczogQXJyYXk8TWVzc2FnZT4pOiBib29sZWFuIHtcbiAgY29uc3QgbWVzc2FnZXMgPSBbXVxuXG4gIGlmIChBcnJheS5pc0FycmF5KGVudHJpZXMpKSB7XG4gICAgbGV0IGludmFsaWRVUkwgPSBmYWxzZVxuICAgIGxldCBpbnZhbGlkSWNvbiA9IGZhbHNlXG4gICAgbGV0IGludmFsaWRFeGNlcnB0ID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZExvY2F0aW9uID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZFNldmVyaXR5ID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZFNvbHV0aW9uID0gZmFsc2VcbiAgICBsZXQgaW52YWxpZFJlZmVyZW5jZSA9IGZhbHNlXG4gICAgbGV0IGludmFsaWREZXNjcmlwdGlvbiA9IGZhbHNlXG4gICAgbGV0IGludmFsaWRMaW50ZXJOYW1lID0gZmFsc2VcblxuICAgIGZvciAobGV0IGkgPSAwLCB7IGxlbmd0aCB9ID0gZW50cmllczsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gZW50cmllc1tpXVxuICAgICAgY29uc3QgeyByZWZlcmVuY2UgfSA9IG1lc3NhZ2VcbiAgICAgIGlmICghaW52YWxpZEljb24gJiYgbWVzc2FnZS5pY29uICYmIHR5cGVvZiBtZXNzYWdlLmljb24gIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGludmFsaWRJY29uID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLmljb24gbXVzdCBiZSBhIHN0cmluZycpXG4gICAgICB9XG4gICAgICBpZiAoXG4gICAgICAgICFpbnZhbGlkTG9jYXRpb24gJiZcbiAgICAgICAgKCFtZXNzYWdlLmxvY2F0aW9uIHx8XG4gICAgICAgICAgdHlwZW9mIG1lc3NhZ2UubG9jYXRpb24gIT09ICdvYmplY3QnIHx8XG4gICAgICAgICAgdHlwZW9mIG1lc3NhZ2UubG9jYXRpb24uZmlsZSAhPT0gJ3N0cmluZycgfHxcbiAgICAgICAgICB0eXBlb2YgbWVzc2FnZS5sb2NhdGlvbi5wb3NpdGlvbiAhPT0gJ29iamVjdCcgfHxcbiAgICAgICAgICAhbWVzc2FnZS5sb2NhdGlvbi5wb3NpdGlvbilcbiAgICAgICkge1xuICAgICAgICBpbnZhbGlkTG9jYXRpb24gPSB0cnVlXG4gICAgICAgIG1lc3NhZ2VzLnB1c2goJ01lc3NhZ2UubG9jYXRpb24gbXVzdCBiZSB2YWxpZCcpXG4gICAgICB9IGVsc2UgaWYgKCFpbnZhbGlkTG9jYXRpb24pIHtcbiAgICAgICAgY29uc3QgcmFuZ2UgPSBSYW5nZS5mcm9tT2JqZWN0KG1lc3NhZ2UubG9jYXRpb24ucG9zaXRpb24pXG4gICAgICAgIGlmIChcbiAgICAgICAgICBOdW1iZXIuaXNOYU4ocmFuZ2Uuc3RhcnQucm93KSB8fFxuICAgICAgICAgIE51bWJlci5pc05hTihyYW5nZS5zdGFydC5jb2x1bW4pIHx8XG4gICAgICAgICAgTnVtYmVyLmlzTmFOKHJhbmdlLmVuZC5yb3cpIHx8XG4gICAgICAgICAgTnVtYmVyLmlzTmFOKHJhbmdlLmVuZC5jb2x1bW4pXG4gICAgICAgICkge1xuICAgICAgICAgIGludmFsaWRMb2NhdGlvbiA9IHRydWVcbiAgICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLmxvY2F0aW9uLnBvc2l0aW9uIHNob3VsZCBub3QgY29udGFpbiBOYU4gY29vcmRpbmF0ZXMnKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWludmFsaWRTb2x1dGlvbiAmJiBtZXNzYWdlLnNvbHV0aW9ucyAmJiAhQXJyYXkuaXNBcnJheShtZXNzYWdlLnNvbHV0aW9ucykpIHtcbiAgICAgICAgaW52YWxpZFNvbHV0aW9uID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLnNvbHV0aW9ucyBtdXN0IGJlIHZhbGlkJylcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgIWludmFsaWRSZWZlcmVuY2UgJiZcbiAgICAgICAgcmVmZXJlbmNlICYmXG4gICAgICAgICh0eXBlb2YgcmVmZXJlbmNlICE9PSAnb2JqZWN0JyB8fFxuICAgICAgICAgIHR5cGVvZiByZWZlcmVuY2UuZmlsZSAhPT0gJ3N0cmluZycgfHxcbiAgICAgICAgICB0eXBlb2YgcmVmZXJlbmNlLnBvc2l0aW9uICE9PSAnb2JqZWN0JyB8fFxuICAgICAgICAgICFyZWZlcmVuY2UucG9zaXRpb24pXG4gICAgICApIHtcbiAgICAgICAgaW52YWxpZFJlZmVyZW5jZSA9IHRydWVcbiAgICAgICAgbWVzc2FnZXMucHVzaCgnTWVzc2FnZS5yZWZlcmVuY2UgbXVzdCBiZSB2YWxpZCcpXG4gICAgICB9IGVsc2UgaWYgKCFpbnZhbGlkUmVmZXJlbmNlICYmIHJlZmVyZW5jZSkge1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IFBvaW50LmZyb21PYmplY3QocmVmZXJlbmNlLnBvc2l0aW9uKVxuICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKHBvc2l0aW9uLnJvdykgfHwgTnVtYmVyLmlzTmFOKHBvc2l0aW9uLmNvbHVtbikpIHtcbiAgICAgICAgICBpbnZhbGlkUmVmZXJlbmNlID0gdHJ1ZVxuICAgICAgICAgIG1lc3NhZ2VzLnB1c2goJ01lc3NhZ2UucmVmZXJlbmNlLnBvc2l0aW9uIHNob3VsZCBub3QgY29udGFpbiBOYU4gY29vcmRpbmF0ZXMnKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWludmFsaWRFeGNlcnB0ICYmIHR5cGVvZiBtZXNzYWdlLmV4Y2VycHQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGludmFsaWRFeGNlcnB0ID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLmV4Y2VycHQgbXVzdCBiZSBhIHN0cmluZycpXG4gICAgICB9XG4gICAgICBpZiAoIWludmFsaWRTZXZlcml0eSAmJiAhVkFMSURfU0VWRVJJVFkuaGFzKG1lc3NhZ2Uuc2V2ZXJpdHkpKSB7XG4gICAgICAgIGludmFsaWRTZXZlcml0eSA9IHRydWVcbiAgICAgICAgbWVzc2FnZXMucHVzaChcIk1lc3NhZ2Uuc2V2ZXJpdHkgbXVzdCBiZSAnZXJyb3InLCAnd2FybmluZycgb3IgJ2luZm8nXCIpXG4gICAgICB9XG4gICAgICBpZiAoIWludmFsaWRVUkwgJiYgbWVzc2FnZS51cmwgJiYgdHlwZW9mIG1lc3NhZ2UudXJsICE9PSAnc3RyaW5nJykge1xuICAgICAgICBpbnZhbGlkVVJMID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLnVybCBtdXN0IGJlIGEgc3RyaW5nJylcbiAgICAgIH1cbiAgICAgIGlmIChcbiAgICAgICAgIWludmFsaWREZXNjcmlwdGlvbiAmJlxuICAgICAgICBtZXNzYWdlLmRlc2NyaXB0aW9uICYmXG4gICAgICAgIHR5cGVvZiBtZXNzYWdlLmRlc2NyaXB0aW9uICE9PSAnZnVuY3Rpb24nICYmXG4gICAgICAgIHR5cGVvZiBtZXNzYWdlLmRlc2NyaXB0aW9uICE9PSAnc3RyaW5nJ1xuICAgICAgKSB7XG4gICAgICAgIGludmFsaWREZXNjcmlwdGlvbiA9IHRydWVcbiAgICAgICAgbWVzc2FnZXMucHVzaCgnTWVzc2FnZS5kZXNjcmlwdGlvbiBtdXN0IGJlIGEgZnVuY3Rpb24gb3Igc3RyaW5nJylcbiAgICAgIH1cbiAgICAgIGlmICghaW52YWxpZExpbnRlck5hbWUgJiYgbWVzc2FnZS5saW50ZXJOYW1lICYmIHR5cGVvZiBtZXNzYWdlLmxpbnRlck5hbWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIGludmFsaWRMaW50ZXJOYW1lID0gdHJ1ZVxuICAgICAgICBtZXNzYWdlcy5wdXNoKCdNZXNzYWdlLmxpbnRlck5hbWUgbXVzdCBiZSBhIHN0cmluZycpXG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIG1lc3NhZ2VzLnB1c2goJ0xpbnRlciBSZXN1bHQgbXVzdCBiZSBhbiBBcnJheScpXG4gIH1cblxuICBpZiAobWVzc2FnZXMubGVuZ3RoKSB7XG4gICAgc2hvd0Vycm9yKFxuICAgICAgJ0ludmFsaWQgTGludGVyIFJlc3VsdCByZWNlaXZlZCcsXG4gICAgICBgVGhlc2UgaXNzdWVzIHdlcmUgZW5jb3VudGVyZWQgd2hpbGUgcHJvY2Vzc2luZyBtZXNzYWdlcyBmcm9tIGEgbGludGVyIG5hbWVkICcke2xpbnRlck5hbWV9J2AsXG4gICAgICBtZXNzYWdlcyxcbiAgICApXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICByZXR1cm4gdHJ1ZVxufVxuXG5leHBvcnQgeyB2YWxpZGF0ZVVJIGFzIHVpLCB2YWxpZGF0ZUxpbnRlciBhcyBsaW50ZXIsIHZhbGlkYXRlSW5kaWUgYXMgaW5kaWUsIHZhbGlkYXRlTWVzc2FnZXMgYXMgbWVzc2FnZXMgfVxuIl19